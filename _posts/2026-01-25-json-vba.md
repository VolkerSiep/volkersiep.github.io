---
layout: post
title:  "Json2VBA"
subtitle: "A fast and ruthless json parser for VBA - validation is not my business."
date:   2026-01-25 20:28:00 +0100
categories: [vba, repository]
featured: true
---
# Background
We developed an Excel add-in that communicates with a back-end local `json-rpc` webservice. This add-in provides a large
number of `UDF`s (user-defined functions) that are extensively called in a typical use-case - in an iterative setting.
Needless to say, the performance was a bottleneck for the well-being of the end-users. 

While some de-bottlenecking was possible on both the web service and in the Excel client, the interesting part was that

  1. The `json-rpc` communication took a significant part of the time, in particular the parsing of `json`, and 
  2. The parsing in python was a lot faster than the parsing in Excel (VBA).

So far, what we have been using was [VBA-JSON], a complete library to handle `json` communication, but not developed
with high performance in mind. Another code, [VBA-JSON-parser], shows high performance, but is released under the GPL
license, which is a stopper for our corporate setting. 

An even more recent and impressive `json` parser is available as [VBA-FastJSON], accessing low level windows APIs.
This one clearly outperforms my own [Json2VBA] specially for larger data structures. Unfortunately, the calls to windows
DLLs, such as `kernel32.dll`, trigger *Windows Defender* on our work PCs. The same author isolated his code for a high
performant dictionary, called [VBA-FastDictionary], which again is multiple times faster as the default 
`Scripting.Dictionary` COM object. Still, I was unfortunately struggling to make it work on our job PCs, again due to
being not allowed to call any 32 bit DLLs. 

# Concept
As we are in this case the developer of both sever and client, we already know that our `json` is well-formed. 
Also, there is no need to code a generic `json` encoder, because most of the structure of the `json-rpc` calls is
static, and the dynamic arguments can efficiently be injected into individual templates. I can therefore focus solely
on the raw parsing -- no validation and no encoding. This reduced the required effort a lot.

It turns out that the `Microsoft VBScript Regular Expressions 5.5` library has a high performance[^1]. 
So, my [Json2VBA] code splits the `json` string using regular expressions and creates a nested structure of dictionaries
and arrays, containing strings, doubles, booleans, and null objects.

# Conclusion

[VBA-JSON] is a well established library to handle `json` in `VBA`. It has a lot of functionality, but it is not the 
fastest.

[VBA-JSON-parser] is a high performant parser for `json`. Just respect the chosen GPL license, obliging derived software
to inherit this license when being distributed.

[VBA-FastJSON] gives probably the fastest parsing of `json` in `VBA`. The only limitation is that it uses 32 bit
Windows DLLs which might be blocked by IT security in a corporate setting (like mine). The author offers also a 
light-speed alternative for `Scripting.Dictionary`, named [VBA-FastDictionary] -- with the same limitations.

**Finally**:
[Json2VBA] is my code that parses `json` in a decent speed, published under the generous MIT license, and not accessing
32 bit DLLs. It should parse all valid `json`, such as 

```json
{ "key1": "value", 
  "key2": [1.2, 3.14, 5.3e-3], 
  "key3": [true, false, null]
}
```
but if you find validation important, beware that it comes without any of that. The same result as above valid `json`
is also obtained by providing this gibberish:
```text
{"key1" $ "value" Ã˜ "key2" @ [Ops1.2y, 3.14=Pi, 5.3e-3], "key3": [true really!, false maybe, nullification]}
```

[^1]: I already get the chills however realizing, as I write this, that it is `VBScript`, which will be phased out by 
      Microsoft, see here: [VBS depreciation], but *Gemini* just comforted me that Microsoft probably wouldn't really 
      remove the dll before many other things will break.

[Json2VBA]: https://github.com/VolkerSiep/Json2VBA
[VBA-JSON]: https://github.com/VBA-tools/VBA-JSON
[VBA-JSON-parser]: https://github.com/omegastripes/VBA-JSON-parser
[VBA-FastJSON]: https://github.com/cristianbuse/VBA-FastJSON
[VBA-FastDictionary]: https://github.com/cristianbuse/VBA-FastDictionary
[VBS depreciation]: https://techcommunity.microsoft.com/blog/windows-itpro-blog/vbscript-deprecation-timelines-and-next-steps/4148301